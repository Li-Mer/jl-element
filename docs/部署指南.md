# 如何将文档部署到 GitHub Pages

本指南将帮助你把 VitePress 文档部署到 GitHub Pages，让其他人通过 URL 访问。

## ⚡ 快速开始

如果你还没有创建 GitHub 仓库，请按以下步骤操作：

1. **在 GitHub 上创建仓库**（推荐使用网页）
   - 访问 [github.com/new](https://github.com/new)
   - 仓库名：`jl-element`
   - 类型：Public（公开）
   - 不要添加 README、.gitignore 或 license

2. **推送本地代码**

   ```bash
   git add .
   git commit -m "配置 GitHub Pages 部署"
   git push -u origin main
   ```

3. **配置 GitHub Pages**
   - 仓库 Settings → Pages
   - Source 选择：GitHub Actions

4. **配置 Actions 权限**（⚠️ 重要！）
   - 仓库 Settings → Actions → General
   - Workflow permissions 选择：**Read and write permissions**
   - 勾选：Allow GitHub Actions to create and approve pull requests
   - 点击 Save

5. **手动触发首次部署**
   - 进入 Actions 标签页
   - 点击 "Deploy Docs" → "Run workflow"

6. **等待部署完成**，访问：`https://你的用户名.github.io/jl-element/`

---

## 📋 前置条件

- 拥有 GitHub 账号
- 代码已推送到 GitHub 仓库（仓库名：`jl-element`）

## 🚀 部署步骤

### 1. 创建 GitHub 远程仓库

#### 方法一：在 GitHub 网页创建（推荐）

1. 打开 [GitHub](https://github.com) 并登录
2. 点击右上角的 `+` 号，选择 **New repository**
3. 填写仓库信息：
   - **Repository name**：`jl-element`（必须与项目名一致）
   - **Description**：`Vue3 组件库`（可选）
   - **Public** 或 **Private**：选择 **Public**（GitHub Pages 免费版需要公开仓库）
   - **不要**勾选 "Add a README file"、".gitignore" 或 "license"（本地已有这些文件）
4. 点击 **Create repository** 创建仓库

#### 方法二：使用 VSCode GitHub 扩展（可选）

1. 在 VSCode 中，按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）
2. 输入 `GitHub: Publish to GitHub`
3. 选择仓库名称：`jl-element`
4. 选择 **Public repository**
5. 按提示登录 GitHub 账号（如果还未登录）

### 2. 推送代码到 GitHub

创建好仓库后，将本地代码推送到 GitHub：

```bash
# 如果还没有配置远程仓库，先添加
git remote add origin https://github.com/你的用户名/jl-element.git

# 确保在 main 分支
git branch -M main

# 添加所有文件
git add .

# 提交改动
git commit -m "配置 GitHub Pages 部署"

# 推送到远程仓库
git push -u origin main
```

> **提示**：如果 `git remote add` 提示已存在，可以先删除：`git remote remove origin`，然后再添加。

> **注意**：首次推送可能需要输入 GitHub 用户名和密码（或 Personal Access Token）。

### 3. 配置 GitHub Pages

1. **打开 GitHub Pages 设置页面**：
   - 访问你的仓库：`https://github.com/你的用户名/jl-element`
   - 点击顶部的 **Settings**（设置）标签
   - 在左侧菜单中找到 **Pages**

2. **配置部署源**：
   - 在 **Build and deployment** 部分
   - **Source** 下拉菜单选择：**`GitHub Actions`**

   > ⚠️ **重要**：确保选择的是 `GitHub Actions`，而不是 `Deploy from a branch`

   **页面说明**：
   - ✅ 你会看到 "Source" 显示为 "GitHub Actions"
   - 下方会显示 "Use a suggested workflow, browse all workflows, or create your own"
   - 这表示配置已正确

3. **关于推荐的工作流**：
   - 页面会展示两个推荐的工作流卡片：
     - **GitHub Pages Jekyll**（带 🧪 图标）- 用于 Jekyll 静态站点
     - **Static HTML**（带 HTML 图标）- 用于纯静态 HTML 文件
   - ✅ **不需要点击这些 Configure 按钮**
   - 我们已经创建了自定义的 `.github/workflows/deploy-docs.yml` 文件
   - 这个文件会自动被 GitHub Actions 识别和使用
   - 下方文字 "Workflow details will appear here once your site has been deployed" 表示等待首次部署

4. **完成配置**：
   - 选择好 `GitHub Actions` 后，**无需点击保存**
   - 配置会自动保存
   - GitHub Pages 已经配置完成！

   > 📌 **接下来做什么**：配置完成后，直接进入下一步"配置 Actions 权限"

### 4. 配置 Actions 权限（⚠️ 必须步骤）

这一步非常重要！如果不配置，部署会失败并显示 404 错误。

1. **进入 Actions 设置页面**：
   - 在仓库页面，点击 **Settings** → 左侧菜单 **Actions** → **General**
   - 或直接访问：`https://github.com/你的用户名/jl-element/settings/actions`

2. **配置工作流权限**：
   - 滚动到页面底部，找到 **"Workflow permissions"** 部分
   - 当前可能显示为 `Read repository contents and packages permissions`
   - 选择：**`Read and write permissions`**
   - ✅ 勾选下方的：**`Allow GitHub Actions to create and approve pull requests`**
   - 点击 **Save** 按钮保存

3. **权限配置说明**：
   - `Read and write permissions`：允许 Actions 写入内容（部署 Pages）
   - 这是部署到 GitHub Pages 的必需权限
   - 不配置会导致 `Error: Creating Pages deployment failed (404)` 错误

### 5. 触发部署

配置完成后，部署会自动开始：

- **首次部署**：配置好 GitHub Pages 后，如果你已经推送过代码，需要手动触发一次：
  1. 点击顶部的 **Actions** 标签页
  2. 如果看到提示 "Workflows aren't being run on this repository"，点击 **I understand my workflows, go ahead and enable them**
  3. 点击左侧的 **Deploy Docs** 工作流
  4. 点击右侧的 **Run workflow** 按钮
  5. 选择 `main` 分支，点击绿色的 **Run workflow** 按钮

- **后续自动部署**：以后每次推送代码到 `main` 分支，都会自动触发部署

### 6. 查看部署状态

1. **进入 Actions 页面**：
   - 点击仓库顶部的 **Actions** 标签
2. **查看工作流运行**：
   - 你会看到 "Deploy Docs" 工作流正在运行
   - 🟡 黄色圆圈 = 正在运行中
   - ✅ 绿色对勾 = 部署成功
   - ❌ 红色叉号 = 部署失败

3. **查看详细日志**：
   - 点击工作流名称可以查看详细的构建日志
   - 如果部署失败，日志会显示错误原因

4. **首次部署时间**：
   - 首次部署通常需要 2-5 分钟
   - 包括安装依赖、构建文档、部署等步骤

### 7. 确认部署完成

部署成功后，回到 **Settings** → **Pages** 页面：

- 页面顶部会显示：✅ **"Your site is live at https://你的用户名.github.io/jl-element/"**
- 点击链接即可访问你的文档站点

## 🌐 访问地址

部署成功后，你的文档将在以下地址访问：

```
https://你的用户名.github.io/jl-element/
```

例如，你的仓库是 `Li-Mer/jl-element`，访问地址就是：

```
https://li-mer.github.io/jl-element/
```

> 💡 **提示**：可以将这个链接添加到仓库的 README.md 或 About 部分，方便其他人访问。

## 📝 本次配置的文件

已自动为你配置以下文件：

1. **`.github/workflows/deploy-docs.yml`** - GitHub Actions 部署脚本
2. **`docs/.vitepress/config.ts`** - 添加了 `base: "/jl-element/"` 配置

## 🔧 本地预览

在推送到 GitHub 之前，可以本地预览部署后的效果：

```bash
# 构建文档
npm run docs:build

# 预览构建结果
npm run docs:preview
```

## ❓ 常见问题

### 推送代码时要求输入用户名密码？

GitHub 已不再支持密码认证，需要使用 **Personal Access Token (PAT)**：

1. 打开 [GitHub Settings → Developer settings → Personal access tokens → Tokens (classic)](https://github.com/settings/tokens)
2. 点击 **Generate new token** → **Generate new token (classic)**
3. 填写信息：
   - **Note**：`jl-element-deploy`
   - **Expiration**：选择过期时间（建议 90 天）
   - **Select scopes**：勾选 `repo`（完整仓库访问权限）
4. 点击 **Generate token**，复制生成的 token（只显示一次！）
5. 在 git push 时，使用 token 作为密码

**更简单的方式**：使用 GitHub CLI 或 VSCode 的 GitHub 扩展登录，会自动处理认证。

### 如何在 VSCode 中登录 GitHub？

1. 点击左下角的账户图标
2. 选择 **Sign in with GitHub**
3. 按提示在浏览器中授权
4. 登录后，VSCode 可以直接推送代码，无需输入密码

### 远程仓库地址错误怎么办？

```bash
# 查看当前远程仓库
git remote -v

# 删除错误的远程仓库
git remote remove origin

# 添加正确的远程仓库
git remote add origin https://github.com/你的用户名/jl-element.git
```

### 部署时出现 404 错误：`Error: Creating Pages deployment failed`？

这是最常见的错误！原因是 GitHub Actions 没有部署权限。

**解决方法：配置 Actions 权限**

1. **进入仓库设置**：
   - 打开 `https://github.com/你的用户名/jl-element/settings/actions`
   - 或：仓库页面 → **Settings** → 左侧菜单 **Actions** → **General**

2. **配置 Workflow 权限**：
   - 滚动到页面底部，找到 **"Workflow permissions"** 部分
   - 选择：**`Read and write permissions`**（读写权限）
   - ✅ 勾选：**`Allow GitHub Actions to create and approve pull requests`**
   - 点击 **Save** 保存

3. **重新运行部署**：
   - 返回 **Actions** 标签页
   - 点击失败的工作流
   - 点击右上角的 **Re-run all jobs**（重新运行所有任务）

4. **等待部署完成**：
   - 这次应该会成功部署
   - 部署成功后，访问 `https://你的用户名.github.io/jl-element/`

> ⚠️ **重要**：这一步是必须的！GitHub 默认权限不足以部署 Pages。

### 部署失败怎么办？

1. 检查 Actions 日志中的错误信息
2. 确保 `package.json` 中的依赖都已正确安装
3. 确认 Node.js 版本符合要求（20+）

### 样式或资源加载失败？

- 确保 `config.ts` 中的 `base` 设置正确：`base: "/jl-element/"`
- 所有资源路径都应该使用相对路径

### 更新文档后没有部署？

- 确认代码已推送到 `main` 分支
- 检查 Actions 是否正在运行
- 可以手动触发工作流

### 部署成功但显示 `Bad credentials` 或 `Getting Pages deployment status failed` 错误？

**这是正常的！** 如果你看到：

- ✅ build 和 deploy 任务都显示绿色对勾
- ✅ 显示了访问链接（如 `https://你的用户名.github.io/jl-element/`）
- ✅ 网站可以正常访问
- ❌ 但 Annotations 中显示 `HttpError: Bad credentials` 或状态获取失败

**说明**：

- 部署本身已经**完全成功**
- 这些错误只是在部署完成后**获取部署状态时发生的**
- 不影响实际的部署结果和网站访问
- 这是 GitHub Actions 的一个已知问题

**解决方法**：

- ✅ 无需任何操作，直接访问你的网站即可
- 以后的部署也会显示这个错误，但都能正常部署，可以忽略
- 如果想消除这个提示，可以等待 GitHub 修复这个问题

## 📚 更多信息

- [VitePress 官方文档](https://vitepress.dev/)
- [GitHub Pages 文档](https://docs.github.com/en/pages)
- [GitHub Actions 文档](https://docs.github.com/en/actions)
